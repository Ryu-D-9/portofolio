<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="todo.css"
<title>To-Do List (LocalStorage + Deadline)</title>
<style>

</style>
</head>
<body>
  <div class="wrap">
    <h1>To-Do List</h1>
    <div class="card">
      <!-- Form tambah -->
      <div class="row">
        <input id="newTask" type="text" placeholder="Tambah tugas… (Enter untuk simpan)"/>
        <input id="newDate" type="date" />
        <button id="addBtn">Tambah</button>
      </div>

      <!-- Daftar -->
      <ul id="list"></ul>

      <!-- Meta / aksi -->
      <div class="meta">
        <small id="counter">0 tugas</small>
        <div class="filters">
          <button class="ghost" data-filter="all">All</button>
          <button class="ghost" data-filter="active">Active</button>
          <button class="ghost" data-filter="done">Done</button>
          <button class="ghost" id="sortDate">Urutkan: Tanggal ⬇</button>
          <button class="ghost danger" id="clearDone">Hapus yang selesai</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ================================
   To-Do List — LocalStorage + Date
   ================================ */
const STORAGE_KEY = "todo.items.v2";

// ---- State ----
let items = load();        // [{id, text, date:'YYYY-MM-DD'|'', done}]
let currentFilter = "all"; // 'all' | 'active' | 'done'
let sortAsc = true;        // sort tanggal naik/turun

// ---- DOM ----
const $  = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const inputNew = $("#newTask");
const inputDate = $("#newDate");
const btnAdd = $("#addBtn");
const ulList = $("#list");
const textCounter = $("#counter");
const btnClearDone = $("#clearDone");
const btnSortDate = $("#sortDate");
const filterBtns = $$(".filters [data-filter]");

// ---- Storage ----
function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; } }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }

// ---- Utils ----
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2);
const todayStr = () => new Date().toISOString().slice(0,10);
function compareDate(a, b){
  // kosong di-akhir
  if (!a) return 1;
  if (!b) return -1;
  return a.localeCompare(b);
}
function dueBadge(dateStr){
  if (!dateStr) return ""; // tanpa badge
  const t = todayStr();
  if (dateStr < t) return `<span class="badge overdue">Jatuh tempo</span>`;
  if (dateStr === t) return `<span class="badge today">Hari ini</span>`;
  return `<span class="badge">Jatuh tempo: ${dateStr}</span>`;
}

// ---- Render ----
function render(){
  let shown = items.slice();

  // filter
  if (currentFilter === "active") shown = shown.filter(i => !i.done);
  if (currentFilter === "done")   shown = shown.filter(i =>  i.done);

  // sort by date (kosong di-akhir)
  shown.sort((a,b) => sortAsc ? compareDate(a.date, b.date) : compareDate(b.date, a.date));

  // list
  ulList.innerHTML = "";
  shown.forEach(item => ulList.appendChild(renderItem(item)));

  // counter
  const left = items.filter(i => !i.done).length;
  textCounter.textContent = `${items.length} tugas • ${left} belum selesai`;

  // highlight filter
  filterBtns.forEach(b => {
    const active = b.dataset.filter === currentFilter;
    b.style.outline = active ? "2px solid rgba(124,92,255,.8)" : "1px solid rgba(255,255,255,.08)";
    b.style.opacity = active ? "1" : ".9";
  });

  // tombol sort label
  btnSortDate.textContent = `Urutkan: Tanggal ${sortAsc ? "⬆" : "⬇"}`;
}

function renderItem(item){
  const li = document.createElement("li");
  li.dataset.id = item.id;

  // checkbox selesai
  const cb = document.createElement("input");
  cb.type = "checkbox";
  cb.checked = item.done;
  cb.addEventListener("change", () => { item.done = cb.checked; save(); render(); });

  // judul (editable)
  const title = document.createElement("input");
  title.type = "text";
  title.className = "title" + (item.done ? " done" : "");
  title.value = item.text;
  title.placeholder = "Tugas tanpa judul";
  title.addEventListener("input", () => { item.text = title.value; save(); });
  title.addEventListener("keydown", e => { if (e.key === "Enter") title.blur(); });

  // kolom aksi kanan
  const right = document.createElement("div");
  right.style.display = "grid";
  right.style.gridTemplateColumns = "auto auto";
  right.style.gap = "8px";
  right.style.alignItems = "center";

  // tanggal (editable)
  const dateWrap = document.createElement("div");
  dateWrap.className = "date";
  dateWrap.innerHTML = dueBadge(item.date);
  const dateInput = document.createElement("input");
  dateInput.type = "date";
  dateInput.value = item.date || "";
  dateInput.title = "Ubah tanggal";
  dateInput.addEventListener("change", () => { item.date = dateInput.value; save(); render(); });

  // hapus
  const del = document.createElement("button");
  del.className = "ghost danger";
  del.textContent = "Hapus";
  del.addEventListener("click", () => {
    items = items.filter(x => x.id !== item.id);
    save(); render();
  });

  right.append(dateInput, del);
  li.append(cb, title, right);

  // badge di bawah judul
  const row2 = document.createElement("div");
  row2.className = "date";
  row2.style.gridColumn = "1 / -1";
  row2.style.marginLeft = "32px";
  row2.innerHTML = dueBadge(item.date);
  li.appendChild(row2);

  return li;
}

// ---- Actions ----
function addTask(){
  const text = (inputNew.value || "").trim();
  const date = inputDate.value;
  if (!text) return;
  items.unshift({ id: uid(), text, date, done:false });
  inputNew.value = "";
  inputDate.value = "";
  save(); render();
}
function clearDone(){
  items = items.filter(i => !i.done);
  save(); render();
}
function setFilter(f){
  currentFilter = f; render();
}
function toggleSort(){
  sortAsc = !sortAsc; render();
}

// ---- Events ----
btnAdd.addEventListener("click", addTask);
inputNew.addEventListener("keydown", e => { if (e.key === "Enter") addTask(); });
btnClearDone.addEventListener("click", clearDone);
btnSortDate.addEventListener("click", toggleSort);
filterBtns.forEach(b => b.addEventListener("click", () => setFilter(b.dataset.filter)));

// ---- First render ----
render();
</script>
</body>
</html>